"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[9490],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var s=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,s)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,s,o=function(e,n){if(null==e)return{};var t,s,o={},r=Object.keys(e);for(s=0;s<r.length;s++)t=r[s],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)t=r[s],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var a=s.createContext({}),u=function(e){var n=s.useContext(a),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=u(e.components);return s.createElement(a.Provider,{value:n},e.children)},v="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return s.createElement(s.Fragment,{},n)}},m=s.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,a=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),v=u(t),m=o,h=v["".concat(a,".").concat(m)]||v[m]||p[m]||r;return t?s.createElement(h,l(l({ref:n},c),{},{components:t})):s.createElement(h,l({ref:n},c))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,l=new Array(r);l[0]=m;var i={};for(var a in n)hasOwnProperty.call(n,a)&&(i[a]=n[a]);i.originalType=e,i[v]="string"==typeof e?e:o,l[1]=i;for(var u=2;u<r;u++)l[u]=t[u];return s.createElement.apply(null,l)}return s.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1418:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>u});var s=t(7462),o=(t(7294),t(3905));const r={sidebar_position:3,title:"\u624b\u5199\u7b80\u6613Promise"},l=void 0,i={unversionedId:"everything/easy-promise",id:"everything/easy-promise",title:"\u624b\u5199\u7b80\u6613Promise",description:"Promise \u6838\u5fc3",source:"@site/docs/everything/easy-promise.mdx",sourceDirName:"everything",slug:"/everything/easy-promise",permalink:"/docs/everything/easy-promise",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"\u624b\u5199\u7b80\u6613Promise"},sidebar:"everything",previous:{title:"React \u7c7b\u4f3c Angular Service \u7684\u72b6\u6001\u7ba1\u7406",permalink:"/docs/everything/react-hooks-service"},next:{title:"vscode\u7684\u7ec8\u7aef\u8bbe\u7f6e\u6210gitbash",permalink:"/docs/everything/vscode-bash"}},a={},u=[{value:"Promise \u6838\u5fc3",id:"promise-\u6838\u5fc3",level:2},{value:"_Promise 1.0 then \u63a5\u6536 resolve data",id:"_promise-10-then-\u63a5\u6536-resolve-data",level:2},{value:"_Promise 2.0 \u5f02\u6b65",id:"_promise-20-\u5f02\u6b65",level:2},{value:"_Promise 3.0 then \u7684\u94fe\u5f0f\u8c03\u7528",id:"_promise-30-then-\u7684\u94fe\u5f0f\u8c03\u7528",level:2},{value:"_Promise 4.0 \u503c\u7684\u7a7f\u900f",id:"_promise-40-\u503c\u7684\u7a7f\u900f",level:2},{value:"_Promise 5.0 \u5176\u4ed6 then \u7684\u8fd4\u56de\u503c",id:"_promise-50-\u5176\u4ed6-then-\u7684\u8fd4\u56de\u503c",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"_Promise.all",id:"_promiseall",level:2}],c={toc:u},v="wrapper";function p(e){let{components:n,...t}=e;return(0,o.kt)(v,(0,s.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"promise-\u6838\u5fc3"},"Promise \u6838\u5fc3"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6709\u4e09\u4e2a\u72b6\u6001 ",(0,o.kt)("inlineCode",{parentName:"li"},"pending"),"\u3001",(0,o.kt)("inlineCode",{parentName:"li"},"resolved"),"\u3001",(0,o.kt)("inlineCode",{parentName:"li"},"rejected"),"\uff0c\u4e00\u65e6\u6539\u53d8\uff0c\u4e0d\u53ef\u9006\u8f6c"),(0,o.kt)("li",{parentName:"ul"},"Promise \u6784\u9020\u51fd\u6570\u63a5\u53d7\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"li"},"excutor")," \u51fd\u6570\uff0c\u7acb\u5373\u6267\u884c"),(0,o.kt)("li",{parentName:"ul"},"excutor \u6709\u4e24\u4e2a\u51fd\u6570\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"resolve"),"\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"reject")),(0,o.kt)("li",{parentName:"ul"},"then \u51fd\u6570\u63a5\u6536\u4e24\u4e2a\u51fd\u6570 -- ",(0,o.kt)("inlineCode",{parentName:"li"},"onResolve"),"\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"onReject")),(0,o.kt)("li",{parentName:"ul"},"then \u7684\u94fe\u5f0f\u8c03\u7528\u548c\u503c\u7684\u7a7f\u900f")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"\u6211\u4eec\u5148\u5b9e\u73b0 resolve"),(0,o.kt)("p",{parentName:"admonition"},"\u6700\u540e\u518d\u628a reject \u7684\u903b\u8f91\u52a0\u4e0a")),(0,o.kt)("h2",{id:"_promise-10-then-\u63a5\u6536-resolve-data"},"_","Promise 1.0 then \u63a5\u6536 resolve data"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(1);\nconst p1 = new _Promise((resolve) => {\n  resolve("success");\n}).then((data) => {\n  console.log(data);\n});\nconsole.log(2);\n// 1 > 2 > success\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u8bbe\u7f6e\u72b6\u6001\uff0c\u57fa\u7840\u53d8\u91cf"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const Pending = Pending;\nconst Resolved = Resolved;\n\nclass _Promise {\n  constructor(executor) {\n    this.status = Pending;\n    let resolve = () => {};\n    executor(resolve);\n  }\n\n  then(onResolve) {}\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u8c03\u7528 resolve \u548c reject \u7684\u65f6\u5019\uff0c\u72b6\u6001\u8981\u6539\u53d8\uff0c\u5e76\u4e14\u628a\u503c\u4fdd\u5b58\u8d77\u6765"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"class _Promise {\n  constructor(executor) {\n    this.status = Pending;\n    this.value = undefined;\n    let resolve = (value) => {\n      if (this.status === Pending) {\n        this.value = value;\n        this.status = Resolved;\n      }\n    };\n    executor(resolve);\n  }\n\n  then(onResolve) {}\n}\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"then \u6267\u884c onResolve \u65b9\u6cd5\uff0c\u5e76\u4e14 promise \u4e2d\u7684 then \u662f\u5f02\u6b65\u7684"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"then(onResolve) {\n  if (this.status === Resolved) {\n    setTimeout(() => {\n      onResolve(this.value);\n    })\n  }\n}\n")))),(0,o.kt)("h2",{id:"_promise-20-\u5f02\u6b65"},"_","Promise 2.0 \u5f02\u6b65"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(1);\nconst p1 = new _Promise((resolve) => {\n  setTimeout(() => {\n    resolve("success");\n  }, 300);\n}).then((data) => {\n  console.log(data);\n});\nconsole.log(2);\n// 1 > 2 > success\n')),(0,o.kt)("p",null,"\u5728 ","_","Promise 1.0 \u4e2d\uff0c\u8fd0\u884c\u5230 then \u65b9\u6cd5\u65f6\uff0c\u56e0\u4e3a\u5f02\u6b65\uff0cresolve \u8fd8\u6ca1\u6709\u6267\u884c\u5b8c\uff0cstatus \u8fd8\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"Pending")," \u72b6\u6001\uff0c\u6240\u4ee5 onResolve\uff0c\u6ca1\u6709\u6267\u884c"),(0,o.kt)("p",null,"\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u628a onResolve \u5b58\u8d77\u6765\uff0c\u7b49\u5230 resolve \u6267\u884c\u5b8c\uff0c\u72b6\u6001\u6539\u53d8\u4e4b\u540e\uff0c\u4e4b\u540e\u518d\u6765\u6267\u884c onResolve"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"class _Promise {\n  constructor(executor) {\n    this.status = Pending;\n    this.value = undefined;\n    this.reason = undefined;\n    this.onResolveCbs = [];\n    let resolve = (value) => {\n      if (this.status === Pending) {\n        this.value = value;\n        this.status = Resolved;\n        this.onResolveCbs.forEach((cb) => cb());\n      }\n    };\n    executor(resolve);\n  }\n\n  then(onResolve) {\n    if (this.status === Resolved) {\n      setTimeout(() => {\n        onResolve(this.value);\n      });\n    }\n    if (this.status === Pending) {\n      this.onResolveCbs.push(() => {\n        setTimeout(() => {\n          onResolve(this.value);\n        });\n      });\n    }\n  }\n}\n")),(0,o.kt)("h2",{id:"_promise-30-then-\u7684\u94fe\u5f0f\u8c03\u7528"},"_","Promise 3.0 then \u7684\u94fe\u5f0f\u8c03\u7528"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(1);\nconst p1 = new _Promise((resolve) => {\n  setTimeout(() => {\n    resolve("success");\n  }, 300);\n})\n  .then((data) => {\n    console.log(data);\n    return 11;\n  })\n  .then((data) => {\n    console.log(data);\n    return 22;\n  })\n  .then((data) => {\n    console.log(data);\n  });\nconsole.log(2);\n// 1 > 2 > success > 11 > 22\n')),(0,o.kt)("p",null,"then \u7684\u94fe\u5f0f\u8c03\u7528\uff0c\u5176\u5b9e\u5c31\u662f then \u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u65b0\u7684 Promise \u5bf9\u8c61"),(0,o.kt)("p",null,"onResolve \u6267\u884c\u540e return \u7684\u503c\uff0c\u9700\u8981\u901a\u8fc7 newPromise resolve \u51fa\u53bb\uff0c\u518d\u8fdb\u884c\u4e0b\u4e00\u4e2a then \u7684\u8c03\u7528"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"then(onResolve) {\n  let x;\n  const newPromise = new _Promise((resolve) => {\n    if (this.status === Resolved) {\n      setTimeout(() => {\n        x = onResolve(this.value);\n        resolve(x);\n      })\n    }\n    if (this.status === Pending) {\n      this.onResolveCbs.push(() => {\n        setTimeout(() => {\n          x = onResolve(this.value);\n          resolve(x);\n        })\n      });\n    }\n  })\n\n  return newPromise\n}\n")),(0,o.kt)("h2",{id:"_promise-40-\u503c\u7684\u7a7f\u900f"},"_","Promise 4.0 \u503c\u7684\u7a7f\u900f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(1);\nconst p1 = new _Promise((resolve) => {\n  setTimeout(() => {\n    resolve("success");\n  }, 300);\n})\n  .then()\n  .then()\n  .then((data) => {\n    console.log(data);\n  });\nconsole.log(2);\n// 1 > 2 > success\n')),(0,o.kt)("p",null,"\u5728 then \u51fd\u6570\u4ec0\u4e48\u53c2\u6570\u90fd\u6ca1\u6709\u4f20\u7684\u65f6\u5019\uff0c\u9700\u8981\u7ed9 onResolve \u4e00\u4e2a\u9ed8\u8ba4\u7684\u65b9\u6cd5\uff0c\u4f7f\u7684\u8fd9\u4e2a value \u503c\u53ef\u4ee5\u4f20\u9012\u4e0b\u53bb"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'then(onResolve) {\n  if(typeof onResolve !== "function") onResolve = (v) => v;\n  let x;\n  const newPromise = new _Promise((resolve) => {\n    if (this.status === Resolved) {\n      setTimeout(() => {\n        x = onResolve(this.value);\n        resolve(x);\n      })\n    }\n    if (this.status === Pending) {\n      this.onResolveCbs.push(() => {\n        setTimeout(() => {\n          x = onResolve(this.value);\n          resolve(x);\n        })\n      });\n    }\n  })\n\n  return newPromise\n}\n')),(0,o.kt)("h2",{id:"_promise-50-\u5176\u4ed6-then-\u7684\u8fd4\u56de\u503c"},"_","Promise 5.0 \u5176\u4ed6 then \u7684\u8fd4\u56de\u503c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(1);\nnew Promise((resolve) => {\n  resolve("success");\n})\n  .then((data) => {\n    console.log(data);\n    return 11;\n  })\n  .then((data) => {\n    console.log(data);\n    return new _Promise((resolve) => {\n      resolve(22);\n    });\n  })\n  .then((data) => {\n    console.log(data);\n  });\nconsole.log(2);\n// 1 > 2 > success > 11 > 22\n')),(0,o.kt)("p",null,"then \u7684\u8fd4\u56de\u503c\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u4e0d\u662f\u5bf9\u8c61\u4e5f\u4e0d\u662f\u51fd\u6570\uff0c\u76f4\u63a5 resolve"),(0,o.kt)("li",{parentName:"ul"},"\u662f\u5bf9\u8c61\u6216\u8005\u51fd\u6570\uff0c\u4f46\u662f\u4e0d\u542b\u6709 then \u51fd\u6570\uff0c\u8bf4\u660e\u4e0d\u662f promise \u5bf9\u8c61\uff0c\u76f4\u63a5 resolve"),(0,o.kt)("li",{parentName:"ul"},"\u662f\u5bf9\u8c61\u6216\u8005\u51fd\u6570\uff0c\u4e14\u542b\u6709 then \u51fd\u6570\uff0c\u8bf4\u660e\u662f promise \u5bf9\u8c61\uff0c\u9700\u8981\u5b9e\u73b0\u8fd9\u4e2a promise \u7136\u540e")),(0,o.kt)("p",null,"\u6240\u4ee5\u9700\u8981\u6839\u636e th \u7684\u8fd4\u56de\u503c\u6765\u5224\u65ad\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u65b9\u6cd5\u6765\u4e13\u95e8\u5904\u7406\u8fd9\u79cd\u60c5\u51b5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'resolvePromise(x, resolve) {\n  resolve(x)\n}\n\nthen(onResolve) {\n  if (typeof onResolve !== "function") onResolve = (v) => v;\n  let x;\n  const newpromise = new _Promise((resolve) => {\n    if (this.status === Resolved) {\n      setTimeout(() => {\n        x = onResolve(this.value);\n        this.resolvePromise(x, resolve);\n      });\n    }\n    if (this.status === Pending) {\n      this.onResolveCbs.push(() => {\n        setTimeout(() => {\n          x = onResolve(this.value);\n          this.resolvePromise(x, resolve);\n        });\n      });\n    }\n  });\n\n  return newpromise;\n}\n')),(0,o.kt)("p",null,"\u6839\u636e\u4e0a\u9762\u60c5\u51b5\u8fdb\u884c\u5224\u65ad"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'resolvePromise(x, resolve) {\n  const xType = typeof x;\n  if (xType !== "object" && xType !== "function") {\n    resolve(x);\n    return;\n  }\n\n  if(typeof x.then !== "function") {\n    resolve(x);\n    return;\n  }\n\n  x.then((data) => {\n    this.resolvePromise(data, resolve)\n  })\n}\n')),(0,o.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,o.kt)("p",null,"\u52a0\u4e0a reject \u548c onReject"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const Pending = "pending";\nconst Resolved = "resolved";\nconst Rejected = "rejected";\n\nclass _Promise {\n  constructor(executor) {\n    this.status = Pending;\n    this.value = undefined;\n    this.reason = undefined;\n    this.onResolveCbs = [];\n    this.onRejectCbs = [];\n    let resolve = (value) => {\n      if (this.status === Pending) {\n        this.value = value;\n        this.status = Resolved;\n        this.onResolveCbs.forEach((cb) => cb());\n      }\n    };\n    let reject = (reason) => {\n      if (this.status === Pending) {\n        this.reason = reason;\n        this.status = Rejected;\n        this.onRejectCbs.forEach((cb) => cb());\n      }\n    };\n    executor(resolve, reject);\n  }\n\n  resolvePromise(x, resolve, reject) {\n    const xType = typeof x;\n    if (xType !== "object" && xType !== "function") {\n      resolve(x);\n      return;\n    }\n\n    if (typeof x.then !== "function") {\n      resolve(x);\n      return;\n    }\n\n    x.then(\n      (data) => {\n        this.resolvePromise(data, resolve);\n      },\n      (reason) => {\n        reject(reason);\n      }\n    );\n  }\n\n  then(onResolve, onReject) {\n    if (typeof onResolve !== "function") onResolve = (v) => v;\n    if (typeof onReject !== "function") onResolve = (v) => v;\n    let x;\n    const newpromise = new _Promise((resolve, reject) => {\n      if (this.status === Resolved) {\n        setTimeout(() => {\n          x = onResolve(this.value);\n          this.resolvePromise(x, resolve, reject);\n        });\n      }\n      if (this.status === Rejected) {\n        setTimeout(() => {\n          x = onReject(this.reason);\n          this.resolvePromise(x, resolve, reject);\n        });\n      }\n      if (this.status === Pending) {\n        this.onResolveCbs.push(() => {\n          setTimeout(() => {\n            x = onResolve(this.value);\n            this.resolvePromise(x, resolve, reject);\n          });\n        });\n        this.onResolveCbs.push(() => {\n          setTimeout(() => {\n            x = onResolve(this.reason);\n            this.resolvePromise(x, resolve, reject);\n          });\n        });\n      }\n    });\n\n    return newpromise;\n  }\n}\n')),(0,o.kt)("h2",{id:"_promiseall"},"_","Promise.all"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"static all(promises) {\n  return new _Promise((resolve, reject) => {\n    let count = 0;\n    let arr = [];\n    promises.forEach((promise, index) => {\n      promise.then(\n        (res) => {\n          count++;\n          arr[index] = res;\n          if (count >= promises.length) resolve(arr);\n        },\n        (err) => {\n          reject(err);\n        }\n      );\n    });\n  });\n}\n")))}p.isMDXComponent=!0}}]);